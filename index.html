<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Unit Circle Practice</title>

<style>
* { box-sizing:border-box; margin:0; padding:0; font-family:Arial,sans-serif; }

body { background:white; }

/* ---------- TOP BAR ---------- */
#topPanel{
  position:fixed; top:0; left:0; width:100%; height:180px;
  background:#f8f8f8; border-bottom:1px solid #aaa;
  display:flex; justify-content:space-around; align-items:center;
  z-index:10;
}

#topTimer{ font-size:26px; font-weight:bold; }

.topButtons{ display:flex; flex-direction:column; gap:10px; }
.topButtons button{ padding:8px 16px; font-weight:bold; cursor:pointer; }

/* ---------- MAIN ---------- */
#content{ margin-top:200px; max-width:900px; margin-inline:auto; }
h1{ text-align:center; margin-bottom:12px; }

table{
  width:100%;
  border-collapse:collapse;
  border:2px solid black;
}
th,td{
  border:1px solid black;
  padding:8px;
  text-align:center;
}
td input{
  width:100%;
  padding:6px;
  font-size:16px;
  text-align:center;
}

td.given{ background:#eee; font-weight:bold; }
td.correct{ background:#90ee90; }
td.incorrect{ background:#ffb6c6; }

/* ---------- SYMBOL PANEL ---------- */
#floatingPanel{
  position:absolute;
  display:none;
  background:white;
  border:1px solid #888;
  padding:4px;
  border-radius:4px;
  z-index:30;
}
.symbol{
  padding:4px 10px;
  background:#eee;
  cursor:pointer;
  display:inline-block;
}

/* ---------- POPUP ---------- */
#overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.4);
  display:none;
  z-index:50;
}

#popup{
  background:white;
  width:300px;
  padding:20px;
  border-radius:8px;
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  text-align:center;
}

#popup button{
  margin-top:20px;
  padding:8px 24px;
  font-weight:bold;
  cursor:pointer;
}
</style>
</head>

<body>

<div id="topPanel">
  <div id="topTimer">00:00</div>
  <div class="topButtons">
    <button id="doneBtn">Done</button>
    <button id="restartBtn">Restart</button>
  </div>
</div>

<div id="content">
  <h1>Unit Circle – Fill Everything Except the Given</h1>
  <table>
    <thead>
      <tr>
        <th>radians</th><th>degrees</th><th>sin</th><th>cos</th><th>tan</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>

<div id="floatingPanel">
  <span class="symbol" data-s="√">√</span>
  <span class="symbol" data-s="π">π</span>
</div>

<div id="overlay">
  <div id="popup">
    <h2>Results</h2>
    <p id="scoreText"></p>
    <p id="percentText"></p>
    <button id="closePopupBtn">Close</button>
  </div>
</div>

<script>
const data=[
 {d:0,r:"0",s:"0",c:"1",t:"0"},
 {d:30,r:"π/6",s:"1/2",c:"√3/2",t:"1/√3"},
 {d:45,r:"π/4",s:"√2/2",c:"√2/2",t:"1"},
 {d:60,r:"π/3",s:"√3/2",c:"1/2",t:"√3"},
 {d:90,r:"π/2",s:"1",c:"0",t:"und."},
 {d:120,r:"2π/3",s:"√3/2",c:"-1/2",t:"-√3"},
 {d:135,r:"3π/4",s:"√2/2",c:"-√2/2",t:"-1"},
 {d:150,r:"5π/6",s:"1/2",c:"-√3/2",t:"-1/√3"},
];

let problems=[],timer,sec=0,lastInput=null;

/* ---------- TIMER ---------- */
function startTimer(){
  clearInterval(timer);
  sec=0;
  topTimer.textContent="00:00";
  timer=setInterval(()=>{
    sec++;
    topTimer.textContent=
      String(Math.floor(sec/60)).padStart(2,"0")+":"+
      String(sec%60).padStart(2,"0");
  },1000);
}

/* ---------- HELPERS ---------- */
const norm=s=>s.toLowerCase().replace(/\s/g,"");
const alt=v=>{
  if(v==="1/√3") return ["1/√3","√3/3"];
  if(v==="-1/√3") return ["-1/√3","-√3/3"];
  return [v];
}

/* ---------- BUILD ---------- */
function build(){
  tableBody.innerHTML="";
  problems.forEach(p=>{
    const tr=document.createElement("tr");
    ["r","d","s","c","t"].forEach(k=>{
      const td=document.createElement("td");
      if(p.g===k){
        td.className="given";
        td.textContent=k==="d"?p[k]+"°":p[k];
      } else {
        const i=document.createElement("input");
        i.onfocus=()=>{lastInput=i;showPanel(i);};
        i.onblur=()=>floatingPanel.style.display="none";
        td.appendChild(i);
      }
      tr.appendChild(td);
    });
    tableBody.appendChild(tr);
  });
}

/* ---------- CHECK ---------- */
function check(){
  document.activeElement.blur();
  clearInterval(timer);

  let score=0,total=0;
  [...tableBody.rows].forEach((tr,i)=>{
    ["r","d","s","c","t"].forEach((k,j)=>{
      const td=tr.cells[j];
      if(td.classList.contains("given")) return;
      total++;
      const val=td.firstChild.value.trim();
      td.classList.remove("correct","incorrect");
      if(val && alt(problems[i][k]).map(norm).includes(norm(val))){
        td.classList.add("correct");
        score++;
      } else {
        td.classList.add("incorrect");
      }
    });
  });

  scoreText.textContent=`Score: ${score} / ${total}`;
  percentText.textContent=`Percentage: ${Math.round(score/total*100)}%`;
  overlay.style.display="block";
}

/* ---------- POPUP FIX ---------- */
closePopupBtn.onclick=()=>{
  overlay.style.display="none";
};

/* ---------- SYMBOLS ---------- */
document.querySelectorAll(".symbol").forEach(s=>{
  s.onmousedown=e=>{
    e.preventDefault();
    if(!lastInput) return;
    const p=lastInput.selectionStart;
    lastInput.value=
      lastInput.value.slice(0,p)+s.dataset.s+
      lastInput.value.slice(p);
    lastInput.focus();
    lastInput.selectionStart=lastInput.selectionEnd=p+1;
  };
});

function showPanel(i){
  const r=i.getBoundingClientRect();
  floatingPanel.style.display="block";
  floatingPanel.style.top=(window.scrollY+r.top-35)+"px";
  floatingPanel.style.left=(window.scrollX+r.left)+"px";
}

/* ---------- RESET ---------- */
function reset(){
  overlay.style.display="none";
  problems=data.map(v=>({...v,g:Math.random()>.5?"r":"d"}));
  build();
  startTimer();
}

/* ---------- INIT ---------- */
doneBtn.onclick=check;
restartBtn.onclick=reset;
reset();
</script>

</body>
</html>
